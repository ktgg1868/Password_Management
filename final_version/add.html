<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 추가</title>
    <style>
        * {
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>비밀번호 추가</h1><br>

    <input type="text" id="service_domain" placeholder="서비스 (google or naver etc)">&nbsp;
    <input type="text" id="service_username" placeholder="사용자 이름 or 이메일">
    <input type="email" id="url" placeholder="서비스 Mail"><br>
    <input type="text" id="keyword" placeholder="키워드 입력">
    <button onclick="generatePassword()">생성</button><br>
    <input type="number" id="Numlength" placeholder="글자수 입력 (기본값:10)"> 암호 길이 입력
    <br>
    <label for="uppercase">대문자 포함</label>
    <input type="checkbox" id="uppercase">
    <br>
    <label for="lowercase">소문자 포함</label>
    <input type="checkbox" id="lowercase">
    <br>
    <label for="numbers">숫자 포함</label>
    <input type="checkbox" id="numbers">
    <br>
    <label for="special">특수문자 포함</label>
    <input type="checkbox" id="special">
    <br><br>
    생성된 비밀번호 <p id='password'></p>
    <br><br>

    <button type="button" onclick="location.href='manage_password.php' ">관리화면</button>

    <script>
        function generatePassword() {
            const keyword = document.getElementById('keyword').value;
            const Numlength = parseInt(document.getElementById('Numlength').value) || 10;
            const includeUppercase = document.getElementById('uppercase').checked;
            const includeLowercase = document.getElementById('lowercase').checked;
            const includeNumbers = document.getElementById('numbers').checked;
            const includeSpecial = document.getElementById('special').checked;

            if (!includeUppercase && !includeLowercase && !includeNumbers && !includeSpecial) {
                alert('한 가지 이상 체크해 주세요');
                return;
            }

            const keywordLength = keyword.length;
            let randomChars = '';
            if (includeUppercase) randomChars += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLowercase) randomChars += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) randomChars += '0123456789';
            if (includeSpecial) randomChars += '!@#$%^&*()';

            const randomCharsLength = Numlength - keywordLength;
            const additionalChars = Array.from({ length: randomCharsLength }, () => {
                return randomChars[Math.floor(Math.random() * randomChars.length)];
            }).join('');

            const combinedString = Math.random() < 0.5 ? additionalChars + keyword : keyword + additionalChars;
            document.getElementById('password').textContent = combinedString;

            // 서버로 전송할 때 평문 비밀번호를 보내고, 서버에서 처리하도록 수정
            fetch('server_edit.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    keyword: keyword,
                    password: combinedString,
                    service_username: document.getElementById('service_username').value,  // 사용자 이름
                    service_domain: document.getElementById('service_domain').value, // 서비스 도메인
                    url: document.getElementById('url').value  // 서비스 URL   
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('비밀번호가 성공적으로 저장되었습니다.');
                    window.location.href = 'manage_password.php';  // 저장 후 관리 페이지로 이동
                } else {
                    alert('비밀번호 저장에 실패했습니다.');
                }
            })
            .catch((error) => {
                console.error("Error: ", error);
                alert('오류가 발생했습니다. 콘솔을 확인하세요.');
            });
        }
    </script>
</body>
</html>
